##############################################################################################################################
# Test notes

hint button not working:
    [qt_manager] No current hint, updating help button within setup_room_interface
    [kiosk timer] Initializing Qt timer display via Overlay...
    [kiosk timer] Qt timer display initialized.
    [qt overlay] Help button hidden
    [video server]Camera check successful
    [video server]Video server ready for connections
    [message handler] Received message: {'type': 'timer_command', 'command_id': '19808ef3-4070-4095-857b-7b2633019b56', 'computer_name': 'CASINO-KIOSK', 'command': 'set', 'minutes': 22, 'request_hash': 'c75b19f2-44dc-49b8-b8dd-6bbe03f570d1'}
    [message handler][DEBUG] Processing timer command (Command ID: 19808ef3-4070-4095-857b-7b2633019b56)
    [message handler][DEBUG] Setting timer to 22.0 minutes
    [kiosk timer] Timer set to 22.0 minutes (maintaining current running state)
    [qt_classes] Setting video skippable: True
    [qt overlay] Connected help button click signal.
    [qt overlay] Help button created and shown
    [qt_classes] Video is skippable, emitting clicked signal.
    [qt_classes] Video is skippable, emitting clicked signal.
    [qt_classes] Video is skippable, emitting clicked signal.




auto reset may not be functional
after auto reset failed, manual reset also failed and there was a crash
auto reset crashed kiosk
    [kiosk timer] Loading timer background for room 3 via Overlay.
    [qt overlay]Attempting to load timer background for room 3
    [qt overlay]Looking for background at: timer_backgrounds\wizard_trials.png
    [qt overlay]Loading background image...
    [qt overlay]Converting to QPixmap...
    [qt overlay]Setting background pixmap...
    [qt overlay]Background loaded successfully
    [qt_manager.py] No current hint, updating help button within setup_room_interface
    [message handler][DEBUG] Kiosk GUI reset complete
    [kiosk main]Displaying game win screen...
    [kiosk main]Clearing hints...
    [qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
    [qt_manager.py] Clearing hint UI elements and hiding Qt counterparts
    [qt_manager.py] Cleared hint text content
    [qt overlay] Cooldown text cleared
    [qt overlay] Cooldown complete
    [qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
    [qt overlay] Victory screen shown.
    [message handler] Received message: {'type': 'timer_command', 'command_id': 'eb3171d2-d2d1-4961-933a-f410ffcf1b52', 'computer_name': 'BACKUP-MINIX', 'command': 'set', 'minutes': 45, 'request_hash': '7ac9513c-1394-4d82-9644-836ecb000caf'}
    [message handler][DEBUG] Processing timer command (Command ID: eb3171d2-d2d1-4961-933a-f410ffcf1b52)
    [message handler][DEBUG] Setting timer to 45.0 minutes
    [kiosk timer] Timer set to 45.0 minutes (maintaining current running state)
    QObject: Cannot create children for a parent that is in a different thread.
    (Parent is QTextDocument(0x1db74a30af0), parent's thread is QThread(0x1db744b0500), current thread is QThread(0x1db7c3e16d0)
    Segmentation fault



(NOTE, PROP WAS STILL FINISHED)

    [qt_classes] HintTextThread emitting update_signal with text: Don't forget about the compute...
[qt_classes] HintTextThread emitting update_signal with text: Don't forget about the compute...
[message handler] Received message: {'type': 'victory', 'command_id': '2ef7a108-5f70-4d91-ad30-49231ef96170', 'room_number': 1, 'computer_name': 'CASINO-KIOSK', 'request_hash': '30c5f9da-73c3-443d-a6f9-fa8e73ba93d6'}
[message handler] Victory detected (Command ID: 2ef7a108-5f70-4d91-ad30-49231ef96170)
[kiosk main]Displaying game win screen...
[kiosk main]Pausing timer due to victory
[kiosk timer] Timer stopped
[qt overlay] Timer hidden
[kiosk main]Clearing hints...
[qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
[qt_manager] Clearing hint UI elements and hiding Qt counterparts
[qt_manager] Cleared hint text content
[qt overlay] Cooldown text cleared
[qt overlay] Cooldown complete
[qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
[qt overlay] Help button hidden
[qt overlay] Victory screen initialized with C:\Users\PanIQ\Desktop\kiosk2.0\kiosk-2.0\kiosk\other_files\victory.png
[qt overlay] Victory screen shown.
[message handler] Received message: {'type': 'timer_command', 'command_id': '8b68baf3-a8e1-4bc3-92c0-d32d9b7ffeda', 'computer_name': 'CASINO-KIOSK', 'command': 'set', 'minutes': 45, 'request_hash': 'a40085a7-d8d4-4d59-9dba-bdaf693c21a4'}
[message handler][DEBUG] Processing timer command (Command ID: 8b68baf3-a8e1-4bc3-92c0-d32d9b7ffeda)
[message handler][DEBUG] Setting timer to 45.0 minutes
[kiosk timer] Timer set to 45.0 minutes (maintaining current running state)
[message handler] Received message: {'type': 'timer_command', 'command_id': 'fefabfbc-43a1-4f27-9557-f0aa1f0f74f3', 'computer_name': 'CASINO-KIOSK', 'command': 'stop', 'request_hash': '73994ac8-a2a8-4fc9-b113-adc958109483'}
[message handler][DEBUG] Processing timer command (Command ID: fefabfbc-43a1-4f27-9557-f0aa1f0f74f3)
[kiosk timer] Timer already stopped, 'stop' command ignored.
[message handler] Received message: {'type': 'reset_kiosk', 'command_id': 'd3a77761-4c5e-4dfc-8718-8d8b191f2a13', 'computer_name': 'CASINO-KIOSK', 'request_hash': 'd6a356ea-9fbb-4a89-8a93-5658850dc79b'}
[message handler][DEBUG] Processing kiosk reset (Command ID: d3a77761-4c5e-4dfc-8718-8d8b191f2a13)
[message handler][DEBUG] Resetting application state...
[message handler][DEBUG] Resetting UI hint state variables...
[message handler][DEBUG] Scheduling GUI reset operations...
[message handler] Executing GUI reset operations on main thread...
[video manager] Force stopping all video playback.
[video manager] Force stop: Setting state flags.
[video manager] Force stop: No player instance found.
[video manager] Force restoring music volume...
[video manager] Force destroying video display (Queued)...
[video manager] Video display destroy request queued.
[video manager] Force stop process finished.
[audio manager]Stopped background music
[audio manager] Stopped all audio.
[message handler] Hiding all Qt overlays...
[qt_overlay.py - hide] === STARTING hide() - Calling _actual_hide via invokeMethod ===
[qt overlay] Victory screen hidden.
[qt overlay][DESTROY_10848] +++ destroy_video_display ENTERED (Thread: 10848) +++
[qt overlay][DESTROY_10848] Video display not destroyed (window missing or not initialized).
[qt overlay][DESTROY_10848] --- destroy_video_display FINISHED (Thread: 10848) ---
[qt_overlay.py - _actual_hide] === STARTING _actual_hide() ===
[qt_overlay.py - hide] Disconnected button_view click signals
[qt_overlay.py - _actual_hide] === COMPLETED _actual_hide() ===
[message handler] Received message: {'type': 'victory', 'command_id': '3125328d-553c-40a8-ac44-2c44c5137d74', 'room_number': 1, 'computer_name': 'CASINO-KIOSK', 'request_hash': '77f2b45d-6c70-4057-a1bf-6343c98f4361'}
[message handler] Victory detected (Command ID: 3125328d-553c-40a8-ac44-2c44c5137d74)
[kiosk main]Displaying game win screen...
[kiosk main]Clearing hints...
[qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
[qt_manager] Clearing hint UI elements and hiding Qt counterparts
[qt_manager] Cleared hint text content
[qt overlay] Cooldown text cleared
[qt overlay] Cooldown complete
[qt overlay] Error clearing hint request text: wrapped C/C++ object of type QGraphicsTextItem has been deleted
[qt overlay] Victory screen shown.
[qt overlay] Victory screen shown.
[message handler] Received message: {'type': 'timer_command', 'command_id': '4d4132c8-8ff0-4fef-8138-25cb6c354dbe', 'computer_name': 'CASINO-KIOSK', 'command': 'set', 'minutes': 45, 'request_hash': '2bd95d88-f993-4506-99b1-a6bdecfa672f'}
[message handler][DEBUG] Processing timer command (Command ID: 4d4132c8-8ff0-4fef-8138-25cb6c354dbe)
[message handler][DEBUG] Setting timer to 45.0 minutes
[kiosk timer] Timer set to 45.0 minutes (maintaining current running state)
QObject: Cannot create children for a parent that is in a different thread.
(Parent is QTextDocument(0x17910186900), parent's thread is QThread(0x1790783d870), current thread is QThread(0x179139f0770)
Segmentation fault


##############################################################################################################################
# Freeze log

[video server]Checking camera availability...
[video_server.check_camera] thread lock here
[qt overlay] Found kiosk_app on tkinter_root
[qt overlay] Stored kiosk_app with computer_name: TIME-MACHINE-KIOSK


...

[message handler] Creating new file downloader for admin IP: 192.168.0.110
[message handler] Initiating sync with admin at 192.168.0.110
[kiosk_file_downloader] Sync requested
[kiosk_file_downloader] Operations appear to be stalled, resetting state...
[kiosk_file_downloader] Reset sync state

...

[kiosk_file_downloader] Processing batch of 10 files (19.3MB)
[kiosk_file_downloader] Processed 50/73 files...
[kiosk_file_downloader] Processing batch of 10 files (44.7MB)
[kiosk_file_downloader] Processed 60/73 files...
[kiosk_file_downloader] Processing batch of 10 files

##############################################################################################################################
# pre-beta testing

hint button doesn't hide fast enough viewing video

##############################################################################################################################
# todo

"currently displayed hint"
"please select nudge frequency"
no progress notification
auto create folders for hint contents
display hint image in new small window
perhaps restart microphone detection when attempting every time (visual audio indicator on admin side too)
reboot kiosk application

hint contents
    import/move over audio hints
    add image hints as custom hints
    add images to the manual hint library
    !film video solutions

rebooter added to kiosk app

soundcheck button functionality
    button which says "touch to play sound"
    button to confirm sound was heard
    button to begin testing microphone (visual indicator of audio for solo soundcheck)
    list of checks including touch seen at admin side

make image viewing overlaying everything instead of hiding elements


##############################################################################################################################
# known priority bugs

admin application instability resulting in/caused by mqtt disconnect codes 16 and 7: paho codes
    MQTT_ERR_ACL_DENIED = 12
    MQTT_ERR_AGAIN = -1
    MQTT_ERR_AUTH = 11
    **MQTT_ERR_CONN_LOST = 7
    MQTT_ERR_CONN_REFUSED = 5
    MQTT_ERR_ERRNO = 14
    MQTT_ERR_INVAL = 3
    **MQTT_ERR_KEEPALIVE = 16
    MQTT_ERR_NOMEM = 1
    MQTT_ERR_NOT_FOUND = 6
    MQTT_ERR_NOT_SUPPORTED = 10
    MQTT_ERR_NO_CONN = 4
    MQTT_ERR_PAYLOAD_SIZE = 9
    MQTT_ERR_PROTOCOL = 2
    MQTT_ERR_QUEUE_SIZE = 15
    MQTT_ERR_SUCCESS = 0
    MQTT_ERR_TLS = 8¶
    MQTT_ERR_UNKNOWN = 13

hangup reliability: 
    kiosk doesn't retry/add itself back to queue after failed sync attempt
    kiosks don't always launch successfully, especially after the video feed check
        "Blocking Network Operations (Highest Probability): This is by far the most likely culprit. The code has multiple places where network operations (sockets, HTTP requests) occur without proper timeouts and error handling. SIGINT (Ctrl+C) often interrupts these blocking calls.
        Deadlocks (Medium Probability): The code uses threading.Lock in several places (audio_server.py, video_server.py, kiosk_file_downloader.py, video_manager.py, prop_data_monitor.py). Improper lock acquisition and release can lead to deadlocks. A single Ctrl+C might interrupt one thread, potentially breaking a deadlock, but this is unreliable.
        Long-running operations in the main Tkinter thread (Medium Probability): Blocking calls in the Tkinter main thread will freeze the GUI and can lead to this behavior. While the code tries to offload to threads, some operations still might occur within after callbacks or event handlers.
        Pygame Mixer Issues (Low Probability): While less likely than network issues, improper use of pygame.mixer can sometimes cause hangs, especially if there are errors loading or playing audio files.
        Infinite Loops (Low Probability): Less likely, but still possible. If any of the while self.running: loops have a subtle bug that prevents them from exiting, this could occur."

##############################################################################################################################
# known low priority bugs

kiosk auto resets twice
kiosk UI element clearing behaviors in relation to videos are flickery due to numerous checks "arguing" about whether they should persist
password for settings gets prompted twice
mqtt connections get crippled while running file sync

##############################################################################################################################
# planned features: 


xyz finished their game (instead of generic victory sound)

kiosk relaunch after sync finish

reset props, reset room (runs reset all + reset kiosk)

windows scaling detection, not having to rotate to landscape

##############################################################################################################################
# ambitious extra ideas:

option to play sound effects, ways for game masters to enjoyably interact with guests

periodic setting of casino/morning after according to room?
"wave back" button
more specific standby audio
log video solution usage to discourage excessive use
make "reset kiosk" a reliable UI debugger somehow
soundcheck logic kiosk side
save props' status for blackbox, delete save upon load
"enable drink menu" by default on
dark theme
hint count on THEIR side
"your host/gamemaster's name" shown at victory/loss(?) screen
route sound to speaker placed in office instead of from headphones
LLM translator call
AI generated text hint based on room state
announce to lobby: room states for automatic standbys/room victory/out of time 
mqtt LEDs for GMs to point out items (checkbox on hints, available or not based on "has_light" flag in prop naming json)
kiosk responds to prop finishes with vfx
technician app (e.g "finish all" button), reset ALLLLLL props, kiosk restarter, soundcheck functionality
dark theme
destroy all tkinter kiosk side

profile creation,
profile deletion (admin only)
save hint to public (usable by all profiles, shown what profile made it, save to own private profile)
save hint to private (local to profile)
save hint to global/default (admin only)
set hint color

##############################################################################################################################

prop monitoring functionality prompt:

For now, on the admin side, it need only print every message it receives from the kiosk, but it will only receive such messages when it has asked the kiosk for them.

So, it sends a message to kiosk message handler, and that tells message_handler to tell prop_data_monitor to gather a copy of all the data and send via networking.

it will be up to the admin's network_broadcast_handler to receive and parse this data, again, but that's later and for now it will just print.

The admin will have a file which will contain all of the IPs that the kiosk will need to report its latest data on, so this info will be included in the message sent via message_handler.

Please examine the structure of prop_name_mapping.json. Each item will have added to it (if necessary; some items will not have an "ip" property) "ip". So when admin requests data on props, it will pull all the IPs from that room's props based on prop_name_mapping.json.